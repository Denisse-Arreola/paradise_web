<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <title>Paradise - Administrador</title>
    <link rel="stylesheet" href="../css/cssBase.css" />
</head>

<body>
    <header>

        <!--Encabezado-->
        Agentes

    </header>






    <section class="sectionPrincipal">

        <article id="barAdmin">
            <table class="upBar">

                <tr>

                    <td> <button onclick="turnOnPnlConsult()">Consultar</button> </td>
                    <td>  <button onclick="turnOnPnlAdd()">Registrar</button>  </td>
                    <td>  <button onclick="turnOnPnlModify()">Modificar</button>  </td>

                </tr>



            </table>

        </article>


        <nav>
            Lista de opciones (Puede estar escondida.) <br />


            <ul>

                <li>
                    <a>Esquemas (Opción predefinida)</a>
                </li>

                <li>
                    <a>Reservaciones</a>
                </li>

                <li>
                    <a  href="HTML_ADMIN_AGENTES.html">Agentes</a>
                </li>

                <li>
                    <a href="HTML_ADMIN_LUGARES.html">Lugares</a>

                    <ol>
                        Provedores
                    </ol>
                    <ol>
                        Municipios
                    </ol>
                </li>

                <li>
                    <a>Clientes</a>
                </li>

            </ul>
        </nav>



        <article id="artMain">


            <section class="consultPanel" id="pnlConsult" style="display:Block">
                <section class='searchForm'>
                    <input type='search' placeholder='Búsqueda de Agente.' id='id_Agente'>
                    <input type='button' style="display:block" id="shcS" value='Buscar' onclick="buscarAgente(true)">
                    <input type='button' style="display:none" id="shcM" value='Buscar' onclick="buscarAgente(false)">
                </section>
            </section>

            <section class="addPanel" id="pnlAdd" style="display:none">
                <section class='registerSection' name='searchAdminForm'>
                    <label id="lblMatricula" style="display:none"> Matrícula del Agente:</label> <input id="tbMatricula" style="display:none" type="text" disabled><br />

                    Nombre del Agente: <input type='text' id='txtNombreAgente' maxlength="30" autofocus required><br />
                    Apellido paterno del Agente: <input type='text' id='txtApPatAgente' maxlength="20" required><br />
                    Apellido materno del Agente: <input type='text' id='txtApMatAgente' maxlength="20" ><br />
                    Genero: 
                    <select id="genreBox">                     
                        <option value="M">Masculino</option>
                        <option value="F">Femenino</option>
                    </select>

                    <br />
                    
                    Fecha de Nacimiento: <input type='date' id="dateNac" required /><br />

                    <input type="button" id="btnSend" style="float:right;display:block" value="Enviar" onclick="registrarAgente(true)" /> <br />

                    <input type="button" id="btnModify" style="float:right;display:none" value="Enviar" onclick="registrarAgente(false)" /> <br />                 

                    <p id="msg">En proceso</p>

                </section>
            </section>

           

            <section id="listAgente" style="display:none; width:100%;"></section>
        </article>

    </section>


    <script>


        function turnOnPnlConsult() {
            document.getElementById("listAgente").innerHTML = "";
            document.getElementById('pnlConsult').style.display = "block";
            document.getElementById('pnlAdd').style.display = "None";
            document.getElementById("listAgente").style.display = "none";
            document.getElementById('shcM').style.display = "none";
            document.getElementById('shcS').style.display = "block";

        }


        function turnOnPnlAdd() {
            document.getElementById("listAgente").innerHTML = "";
            document.getElementById('pnlConsult').style.display = "None";
            document.getElementById('pnlAdd').style.display = "block";
            document.getElementById("listAgente").style.display = "none";

        }

        function turnOnPnlModify() {
            document.getElementById("listAgente").innerHTML = "";
            document.getElementById('pnlConsult').style.display = "block";
            document.getElementById('pnlAdd').style.display = "None";
            document.getElementById("listAgente").style.display = "none";
            document.getElementById('shcM').style.display = "block";
            document.getElementById('shcS').style.display = "none";

        }

        function registrarAgente(res) {
            document.getElementById("listAgente").innerHTML = "";          

            var agenteOb = null;

            if (res == true) {

                agenteOb = {
                    nombre: document.getElementById("txtNombreAgente").value,
                    apPat: document.getElementById("txtApPatAgente").value,
                    apMat: document.getElementById("txtApMatAgente").value,
                    genre: document.getElementById("genreBox").options[0].value,
                    date: document.getElementById("dateNac").value,
                    type: true
                };
            } else {

                agenteOb = {
                    matricula: document.getElementById('tbMatricula').value,
                    nombre: document.getElementById("txtNombreAgente").value,
                    apPat: document.getElementById("txtApPatAgente").value,
                    apMat: document.getElementById("txtApMatAgente").value,
                    genre: document.getElementById("genreBox").options[0].value,
                    date: document.getElementById("dateNac").value,
                    type: false
                };

            }

            var ajax = new XMLHttpRequest();
            ajax.onreadystatechange= function () {
                if (ajax.readyState== 4 && ajax.status==200){
                    document.getElementById("msg").innerHTML = ajax.responseText;
                }
            };

            ajax.open("GET", "../php/registerUpdateAgente.php?b=" + JSON.stringify(agenteOb), true);
            ajax.send();
        }


        function buscarAgente(res) {
            document.getElementById("listAgente").innerHTML = "";
            var ajax = new XMLHttpRequest();

            var searchForm= null;

            searchForm = {
                nombre: document.getElementById("id_Agente").value,
                type: res
            };
           
            ajax.onreadystatechange = function () {
                if (ajax.readyState == 4 && ajax.status == 200) {
                    extractAgenteData(ajax.responseText);                                        
                }
            };

            ajax.open("GET", "../php/busquedaAgente.php?b=" + JSON.stringify(searchForm), true);
            ajax.send();

        }


        function extractAgenteData(ob) {

            document.getElementById("listAgente").style.display = "block";

            var x = 0;
            var str = "";

            var obAgente = JSON.parse(ob);
            var arrayAgente = obAgente.agentesArray;

            while (arrayAgente[x]) {               

                str +=
    "<table style='width:30%;margin-right:8%; border:2px solid;margin-bottom:3%;'>" +
    "<tr>" +
        "<td>Matricula: </td>" +
            "<td>" + arrayAgente[x].matricula + " </td>" +
        "</tr>" +

        "<tr>" +
            "<td>Nombre: </td>" +
            "<td>" + arrayAgente[x].nombre + " </td>" +
        "</tr>" +

        "<tr>" +
            "<td>Apellido Paterno: </td>" +
            "<td>" + arrayAgente[x].apPat + " </td>" +
        "</tr>" +

        "<tr>" +
            "<td>Apellido Materno: </td>" +
            "<td>" + arrayAgente[x].apMat + " </td>" +
        "</tr>" +


        "<tr>" +
            "<td> Nacimiento: </td>" +
            "<td>" + arrayAgente[x].nacimiento + " </td>" +
        "</tr>" +


         "<tr>" +
            "<td> Genero: </td>" +
            "<td>" + arrayAgente[x].genero + " </td>" +
        "</tr>" +
    "</table >";

                if (obAgente.type == false) {
                    //str += "<button onclick='modifyAgente("+arrayAgente[x]+")'>click</button>";

                    document.getElementById("listaAgente");
                }

                x += 1;
            }

            document.getElementById("listAgente").innerHTML = str;

        }

        function modifyAgente(a) {
            turnOnPnlAdd();                        

            document.getElementById('tbMatricula').value=a.matricula;
           document.getElementById("txtNombreAgente").value=a.nombre;
           document.getElementById("txtApPatAgente").value=a.apPat;
           document.getElementById("txtApMatAgente").value=a.apMat;
           //document.getElementById("genreBox").options[0];
           //document.getElementById("dateNac").value=a.;


            document.getElementById("tbMatricula").style.display = "block";
            document.getElementById("lblMatricula").style.display = "block";

            document.getElementById("tbMatricula").value = a.numero;

        }


       
        

    </script>

</body>
</html>