

<html lang="en">
<head>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../css/CSS_PERFIL_USUARIO.css" type="text/css">
    <meta meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Paradise - Perfil</title>

    <script src="../js/session.js"></script>
</head>
<body onload="sesion();">
        <nav class="NavOficial">
            <img src="../img/logoOficial.png" alt="Logotipo" width="30%" class="logoNav" />

            <section class="pruebaMenu">
                <article class="pMT"><a href="../index.html" ;>INICIO</a></article>
                <article class="pMTx"><a href="HTML_QUIENES_SOMOS.html" ;>¿QUIÉNES SOMOS?</a></article>
                <article class="pMT3"><a href="../html/HTML_LUGARES.html" ;>LUGARES Y SALONES</a></article>
                <article class="pMT2"><a href="../html/construccion.html" ;>PROMOCIONES</a></article>
                <article class="pMTxt" id="log"><a href="./html/HTML_LOG_IN.html" ;>INICIAR SESION</a></article>

                <article class="pMTxt1" id="login" style="display:none;"><a href="HTML_SIGN_IN.html";>
                    <a href="../html/construccion.html" ;><img src="../img/Loto_paradise.png" width="45%;" />&nbsp;&nbsp;&nbsp;&nbsp;</a>
                    <a href="../php/actions/session_out.php" ;><img src="../img/log_out.png" width="25%;" /></a>
                </article>

            </section>
            <br />
            <section class="barraBusqueda">
                <input type="text" id="searchterm" class="busqueda" placeholder="¿Qué estás buscando?" />
                <button type="button" id="search" class="boton">Buscar</button>
            </section>
            
            <br />

        </nav>

    <br />
    <main>
        <nav>
            <section class="Nav2do">
                <hr class="hotl" />&nbsp;&nbsp;&nbsp;<a href="construccion.html">Inicio</a>&nbsp;&nbsp;&nbsp;<hr class="hotl" />&nbsp;&nbsp;&nbsp;
                <a href="construccion.html">Agentes</a>&nbsp;&nbsp;&nbsp;<hr class="hotl" />&nbsp;&nbsp;&nbsp;<a href="construccion.html">Proveedores</a>&nbsp;&nbsp;&nbsp;<hr class="hotl" />&nbsp;&nbsp;&nbsp;
                <a href="construccion.html">Otros Servicios</a>&nbsp;&nbsp;&nbsp;<hr class="hotl" />&nbsp;&nbsp;&nbsp;<a href="construccion.html">Contacto</a>&nbsp;&nbsp;&nbsp;<hr class="hotl" />
            </section>
        </nav>

        <section class="secPrincipal">
            <section class="perfil">
                <br />
                <img src="../img/user_sin_foto.png" width="40%" />
                <br />
                <i>Juanito Alcachofa</i>
                <br /><br /><br />
                <section class="Plateral">
                    <hr /><br /><button class="button2" onclick="usarHistorial()">Historial</button><br />
                    <hr /><br /><button class="button2" onclick="usarConfiguracion()">Configuración</button>
                    <hr /><section class="button2"><a href="../php/salir.php";>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Cerrar Sesión</a></section>
                    
                    <!--<hr /><br /><button class="button2" onclick="">Cerrar Sesión</button><hr />-->
                </section>
            </section>

            <section class="acciones">
                
                <!--ESTA SECCIÓN ES DEL HISTORIAL-->
                <section class="historial" id="historial" style="display:none">
                    <br />
                    <h3>Historial de tus reservaciones</h3>
                    <section id="listaRes" style="display:none; width:100%; height:100%;"></section>
                    <br />
                </section>

                <!--ESTA SECCIÓN ES PARA ACTUALIZAR-->
                <section class="configuracion" id="configuracion" style="display:none">
                    <br /><br />
                    <h3>Configuración general de la cuenta</h3>
                    <br /><br />
                    <section id="data"></section>
                </section>


            </section>

            <dialog id="error">
                 <p>La contraseña no coincide</p><br />
                 <input type="button"  onclick="cerrar()" value="Cerrar"/>
            </dialog>



        </section>

    </main>

    


    <script>

       

        function usarConfiguracion() {
            //document.getElementById('reservacion').style.display = "None";
            document.getElementById('historial').style.display = "None";
            document.getElementById('configuracion').style.display = "block";

                var ajax = new XMLHttpRequest();

                ajax.onreadystatechange = function () {
                    if (ajax.status == 200 && ajax.readyState == 4) {
                        //document.getElementById('data').innerHTML = ajax.responseText;
                        fillData(ajax.responseText);
                        //console.log(JSON.parse(ajax.responseText));
                    }
                };

                ajax.open("get", "../php/actions/update_cliente.php?", true);
                ajax.send();
        }

        function fillData(ob) {

            var seccion = document.getElementById('data');

            //--------------------------- Variables del JSON ------------------------------------------------
            var obj = JSON.parse(ob);
            var nombre = obj.nombre;
            var paterno = obj.paterno;
            var materno = obj.materno;
            var nacimiento = obj.nacimiento;
            var edad = obj.edad;
            var telefono = obj.telefono;
            var usuario = obj.usuario.nombre;
            var contrasenia = obj.usuario.contrasenia;
            var correo = obj.usuario.correo;
            //--------------------------- Variables del JSON ------------------------------------------------

            //--------------------------- Elementos para append child ------------------------------------------------

            var user_bt = document.createElement("button");
            user_bt.setAttribute("class", "updBoton");
            user_bt.addEventListener('click', function () { updUser(); });
            user_bt.innerHTML = 'Editar';
            //ESTO LO HIZO TONATIUH

            var pssw_bt = document.createElement("button");
            pssw_bt.setAttribute("class", "updBoton");
            pssw_bt.addEventListener('click', function () { updPssw(); });
            pssw_bt.innerHTML = 'Editar';
            //ESTO LO HIZO TONATIUH

            var tel_bt = document.createElement("button");
            tel_bt.setAttribute("class", "updBoton");
            tel_bt.addEventListener('click', function () { updTel(); });
            tel_bt.innerHTML = 'Editar';
            //ESTO LO HIZO TONATIUH

            var parent = document.createElement('section');
            parent.setAttribute("class", "complete_section");

            var child1 = document.createElement('section');
            child1.setAttribute("class", "child");
            child1.innerHTML = nombre + paterno + materno;

            var child2 = document.createElement('section');
            child2.setAttribute("class", "child");
            child2.innerHTML = nacimiento;

            var child3 = document.createElement('section');
            child3.setAttribute("class", "child");
            child3.innerHTML = edad;

            var child4 = document.createElement('section');
            child4.setAttribute("class", "child");
            child4.innerHTML = telefono;

            var child5 = document.createElement('section');
            child5.setAttribute("class", "child");
            child5.innerHTML = usuario;

            var child6 = document.createElement('section');
            child6.setAttribute("class", "child");
            child6.innerHTML = contrasenia;

            var child7 = document.createElement('section');
            child7.setAttribute("class", "child");
            child6.innerHTML = correo;

            var child1_1 = document.createElement('section');
            child1_1.setAttribute("class", "child");
            child1_1.innerHTML = 'NOMBRE: ';

            var child2_2 = document.createElement('section');
            child2_2.setAttribute("class", "child");
            child2_2.innerHTML = 'FECHA DE NACIMIENTO: ';

            var child3_3 = document.createElement('section');
            child3_3.setAttribute("class", "child");
            child3_3.innerHTML = 'EDAD: ';

            var child4_4 = document.createElement('section');
            child4_4.setAttribute("class", "child");
            child4_4.innerHTML = 'TÉLEFONO: ';

            var child5_5 = document.createElement('section');
            child5_5.setAttribute("class", "child");
            child5_5.innerHTML = 'USUARIO: ';

            var child6_6 = document.createElement('section');
            child6_6.setAttribute("class", "child");
            child6_6.innerHTML = 'CONTRASEÑA: ';

            var child7_7 = document.createElement('section');
            child7_7.setAttribute("class", "child");
            child7_7.innerHTML = 'CORREO: ';
            //var br = document.createElement('br');
            //--------------------------- Elementos para append child ------------------------------------------------



            child4.appendChild(tel_bt);
            child5.appendChild(user_bt);
            child6.appendChild(pssw_bt);

            seccion.appendChild(parent);

            parent.appendChild(child1_1);
            parent.appendChild(child1);
            parent.appendChild(child2_2);
            parent.appendChild(child2);
            parent.appendChild(child3_3);
            parent.appendChild(child3);
            parent.appendChild(child4_4);
            parent.appendChild(child4);
            parent.appendChild(child5_5);
            parent.appendChild(child5);
            parent.appendChild(child6_6);
            parent.appendChild(child6);
            parent.appendChild(child7_7);
            parent.appendChild(child7);
            

            //console.log(nombre, paterno, materno, nacimiento, edad, telefono, usuario, contrasenia, correo);

        }























        function updUser() {

            var form1 = '<label>Usuario:&nbsp;</label><input name="txtUsuario" type="text" id="txtUsuario" pattern="[A-Za-z0-9._%+-]{6,}" title="Puede contener números, letras en mayúsculas y minusculas" required ><br />';
            var form2 = '<button id="user" onclick="update()">Guardar</button>'  //Recuerda que el ID es el alias que vas a editar en el update.
            document.getElementById('configForm').innerHTML = '';
            document.getElementById('configForm').innerHTML = form1 + form2;
            document.getElementById('configForm').style.display = "block";
        }

        function updPssw() {
            //var form1 = '<label>Actual Contraseña:&nbsp;</label><input name="txtPass" type="password" id="oldPass" pattern="[A-Za-z0-9._%+-]{6,}" title="Minimo 6 caracteres" required><br />';
            var form2 = '<label>Nueva Contraseña:&nbsp;</label><input name="txtPass" type="password" id="txtPass" pattern="[A-Za-z0-9._%+-]{6,}" title="Minimo 6 caracteres" required><br />';
            var form3 = '<label>Confirmar Contraseña:&nbsp;</label><input name="txtConfiPass" type="password" id="txtConfiPass" pattern="[A-Za-z0-9._%+-]{6,}" title="Confirma la contraseña" required><br />';
            var form4 = '<button id="password" onclick="update()">Guardar</button>'  //Recuerda que el ID es el alias que vas a editar en el update.
            document.getElementById('configForm').innerHTML = '';
            document.getElementById('configForm').innerHTML = form2 + form3 + form4;
            document.getElementById('configForm').style.display = "block";
        }

        function updTel() {
            var form1 = '<label>Número de Teléfono: </label><input name="txtTelefono" type="tel" id="txtTelefono" required />';
            var form2 = '<button id="telefono" onclick="update()">Guardar</button>'  //Recuerda que el ID es el alias que vas a editar en el update.
            document.getElementById('configForm').innerHTML = '';
            document.getElementById('configForm').innerHTML = form1 + form2;
            document.getElementById('configForm').style.display = "block";
        }

        

        function update() {
            txtTelefono = document.getElementById('txtTelefono').value;
                if (txtTelefono = null) {
                    txtTelefono = '';
                }
            txtUsuario = document.getElementById('txtUsuario').value;
                if (txtUsuario = null) {
                txtUsuario = '';
                }
            txtPass = document.getElementById('txtPass').value;
                if (txtPass = null) {
                    txtPass = '';
                }
            confipassword = document.getElementById('txtConfiPass').value;

            //document.getElementById('inscrito').innerHTML = 'Entró a la función';

            console.log('Entró a la función');


            if (txtPass != confipassword) {
                var dialogo = document.getElementById('error');
                dialogo.showModal();
            }

             console.log(txtTelefono,txtUsuario,txtPass);

        }

        function cerrar()
        {
            document.getElementById("error").close();
        }


        function usarHistorial() {
            //document.getElementById('reservacion').style.display = "None";
            document.getElementById('historial').style.display = "block";
            document.getElementById('configuracion').style.display = "None";

            document.getElementById("listaRes").innerHTML = "";

            var ajax = new XMLHttpRequest();

            ajax.onreadystatechange = function () {
                if (ajax.readyState == 4 && ajax.status == 200) {
                    document.getElementById("listaRes").style.display = "block";
                    document.getElementById("listaRes").innerHTML = ajax.responseText;
                }
            };


            ajax.open("GET", "../php/showResPerUs.php?", true);
            ajax.send();
        }



        function buscarRes() {
            document.getElementById("listaRes").innerHTML = "";

            var ajax = new XMLHttpRequest();

            ajax.onreadystatechange = function () {
                if (ajax.readyState == 4 && ajax.status == 200) {
                    document.getElementById("listLugar").style.display = "block";
                    document.getElementById("listLugar").innerHTML = ajax.responseText;
                }
            };


            ajax.open("GET", "../php/buscarLugares.php?", true);
            ajax.send();

        }

    </script>

   

</body>
</html>