

<html lang="en">
<head>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../css/CSS_PERFIL_USUARIO.css" type="text/css">
    <meta meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Paradise - Perfil</title>
</head>
<body onload="sesion();">
        <nav class="NavOficial">
            <img src="../img/logoOficial.png" alt="Logotipo" width="30%" class="logoNav" />

            <section class="pruebaMenu">
                <article class="pMT"><a href="../index.html" ;>INICIO</a></article>
                <article class="pMTx"><a href="HTML_QUIENES_SOMOS.html" ;>¿QUIÉNES SOMOS?</a></article>
                <article class="pMT3"><a href="../html/HTML_LUGARES.html" ;>LUGARES Y SALONES</a></article>
                <article class="pMT2"><a href="../html/construccion.html" ;>PROMOCIONES</a></article>
                <article class="pMTxt" id="log"><a href="./html/HTML_SIGN_IN.html" ;>INICIAR SESION</a></article>

                <article class="pMTxt1" id="login" style="display:none;">
                <a href="../html/construccion.html";><img src="../img/Loto_paradise.png" width="45%;" />&nbsp;&nbsp;&nbsp;&nbsp;</a>
                <a href="../php/salir.php";><img src="../img/log_out.png" width="25%;" /></a></article>

            </section>
            <br />
            <section class="barraBusqueda">
                <input type="text" id="searchterm" class="busqueda" placeholder="¿Qué estás buscando?" />
                <button type="button" id="search" class="boton">Buscar</button>
            </section>
            
            <br />

        </nav>

    <br />
    <main>
        <nav>
            <section class="Nav2do">
                <hr class="hotl" />&nbsp;&nbsp;&nbsp;<a href="construccion.html">Inicio</a>&nbsp;&nbsp;&nbsp;<hr class="hotl" />&nbsp;&nbsp;&nbsp;
                <a href="construccion.html">Agentes</a>&nbsp;&nbsp;&nbsp;<hr class="hotl" />&nbsp;&nbsp;&nbsp;<a href="construccion.html">Proveedores</a>&nbsp;&nbsp;&nbsp;<hr class="hotl" />&nbsp;&nbsp;&nbsp;
                <a href="construccion.html">Otros Servicios</a>&nbsp;&nbsp;&nbsp;<hr class="hotl" />&nbsp;&nbsp;&nbsp;<a href="construccion.html">Contacto</a>&nbsp;&nbsp;&nbsp;<hr class="hotl" />
            </section>
        </nav>

        <section class="secPrincipal">
            <section class="perfil">
                <br />
                <img src="../img/user_sin_foto.png" width="40%" />
                <br />
                <i>Juanito Alcachofa</i>
                <br /><br /><br />
                <section class="Plateral">
                    <hr /><br /><button class="button2" onclick="usarHistorial()">Historial</button><br />
                    <hr /><br /><button class="button2" onclick="usarConfiguracion()">Configuración</button>
                    <hr /><section class="button2"><a href="../php/salir.php";>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Cerrar Sesión</a></section>
                    
                    <!--<hr /><br /><button class="button2" onclick="">Cerrar Sesión</button><hr />-->
                </section>
            </section>

            <section class="acciones">
                

                <section class="historial" id="historial" style="display:none">
                    <br />
                    <h3>Historial de tus reservaciones</h3>
                    <section id="listaRes" style="display:none; width:100%; height:100%;"></section>
                    <br />
                </section>

                <section class="configuracion" id="configuracion" style="display:none">
                    <section id="data"></section>

                    <section id="configForm" style="display:none">
                        <form>
                           <table class="registrar">
                            <tr>
                                <th><label>Nombre: </label></th>
                                <th><input name="txtNombre" type="text" maxlength="30" id="txtNombre" required /></th>
                            </tr>
                           </table>
                        </form>
                    </section>

                </section>
            </section>

            <dialog id="error">
                 <p>La contraseña no coincide</p><br />
                 <input type="button"  onclick="cerrar()" value="Cerrar"/>
            </dialog>



        </section>

    </main>

    


    <script>

       

        function usarConfiguracion() {
            //document.getElementById('reservacion').style.display = "None";
            document.getElementById('historial').style.display = "None";
            document.getElementById('configuracion').style.display = "block";

                var ajax = new XMLHttpRequest();

                ajax.onreadystatechange = function () {
                    if (ajax.status == 200 && ajax.readyState == 4) {
                        document.getElementById('data').innerHTML = ajax.responseText;
                    }
                };

                ajax.open("get", "../php/config_user.php?", true);
                ajax.send();
        }

        function updUser() {

            var form1 = '<label>Usuario:&nbsp;</label><input name="txtUsuario" type="text" id="txtUsuario" pattern="[A-Za-z0-9._%+-]{6,}" title="Puede contener números, letras en mayúsculas y minusculas" required ><br />';
            var form2 = '<button id="user" onclick="update()">Guardar</button>'  //Recuerda que el ID es el alias que vas a editar en el update.
            document.getElementById('configForm').innerHTML = '';
            document.getElementById('configForm').innerHTML = form1 + form2;
            document.getElementById('configForm').style.display = "block";
        }

        function updPssw() {
            //var form1 = '<label>Actual Contraseña:&nbsp;</label><input name="txtPass" type="password" id="oldPass" pattern="[A-Za-z0-9._%+-]{6,}" title="Minimo 6 caracteres" required><br />';
            var form2 = '<label>Nueva Contraseña:&nbsp;</label><input name="txtPass" type="password" id="txtPass" pattern="[A-Za-z0-9._%+-]{6,}" title="Minimo 6 caracteres" required><br />';
            var form3 = '<label>Confirmar Contraseña:&nbsp;</label><input name="txtConfiPass" type="password" id="txtConfiPass" pattern="[A-Za-z0-9._%+-]{6,}" title="Confirma la contraseña" required><br />';
            var form4 = '<button id="password" onclick="update()">Guardar</button>'  //Recuerda que el ID es el alias que vas a editar en el update.
            document.getElementById('configForm').innerHTML = '';
            document.getElementById('configForm').innerHTML = form2 + form3 + form4;
            document.getElementById('configForm').style.display = "block";
        }

        function updTel() {
            var form1 = '<label>Número de Teléfono: </label><input name="txtTelefono" type="tel" id="txtTelefono" required />';
            var form2 = '<button id="telefono" onclick="update()">Guardar</button>'  //Recuerda que el ID es el alias que vas a editar en el update.
            document.getElementById('configForm').innerHTML = '';
            document.getElementById('configForm').innerHTML = form1 + form2;
            document.getElementById('configForm').style.display = "block";
        }

        

        function update() {
            txtTelefono = document.getElementById('txtTelefono').value;
                if (txtTelefono = null) {
                    txtTelefono = '';
                }
            txtUsuario = document.getElementById('txtUsuario').value;
                if (txtUsuario = null) {
                txtUsuario = '';
                }
            txtPass = document.getElementById('txtPass').value;
                if (txtPass = null) {
                    txtPass = '';
                }
            confipassword = document.getElementById('txtConfiPass').value;

            //document.getElementById('inscrito').innerHTML = 'Entró a la función';

            console.log('Entró a la función');


            if (txtPass != confipassword) {
                var dialogo = document.getElementById('error');
                dialogo.showModal();
            }

             console.log(txtTelefono,txtUsuario,txtPass);

        }

        function cerrar()
        {
            document.getElementById("error").close();
        }


        function usarHistorial() {
            //document.getElementById('reservacion').style.display = "None";
            document.getElementById('historial').style.display = "block";
            document.getElementById('configuracion').style.display = "None";

            document.getElementById("listaRes").innerHTML = "";

            var ajax = new XMLHttpRequest();

            ajax.onreadystatechange = function () {
                if (ajax.readyState == 4 && ajax.status == 200) {
                    document.getElementById("listaRes").style.display = "block";
                    document.getElementById("listaRes").innerHTML = ajax.responseText;
                }
            };


            ajax.open("GET", "../php/showResPerUs.php?", true);
            ajax.send();
        }



        function buscarRes() {
            document.getElementById("listaRes").innerHTML = "";

            var ajax = new XMLHttpRequest();

            ajax.onreadystatechange = function () {
                if (ajax.readyState == 4 && ajax.status == 200) {
                    document.getElementById("listLugar").style.display = "block";
                    document.getElementById("listLugar").innerHTML = ajax.responseText;
                }
            };


            ajax.open("GET", "../php/buscarLugares.php?", true);
            ajax.send();

        }

    </script>

    <script>

        function sesion() {

            var ajax = new XMLHttpRequest();

            ajax.onreadystatechange = function () {
                if (ajax.status == 200 && ajax.readyState == 4) {


                    var obj_user = JSON.parse(ajax.responseText); 
                    var respuesta = obj_user.res;
                    var usuario = obj_user.tipo;
                    var num = obj_user.user;


                    if (respuesta == true && usuario=='Cliente') {
                        document.getElementById('login').style.display = "block";
                        document.getElementById('log').style.display = "none";

                        var oneObj = new ob_user();

                        oneObj.setUser(num);
                        oneObj.setTipo(usuario);

                    //--------------------GUARDAR---ESTO---!!!!!!!!!!!--------------------------------------------
                        //var prueba = oneObj.getUser();
                        //console.log(prueba);
                    //--------------------------------------------------------------------------------------------

                        //var type_user = ajax.responseText;
                        //console.log(type_user);

                    } else {
                        location.href = "../index.html";
                    }


                }
                
            }

            ajax.open("GET", "../php/sesion_verify.php?", true);
            ajax.send();

            
        }

        //Este objeto funciona bien raro :v
        
        var ob_user = function(user,tipoU) {

            //INICIO DEL CONSTRUCTOR
            this.user = '' || user;
            this.tipoU = '' || tipoU;
            //FIN DEL CONSTRUCTOR

            //FUNCIONES PROPIAS DEL OBJETO
            this.setUser = function (us) {
                this.user = us;
                //console.log(this.user);
            };

            this.setTipo = function (tp) {
                this.tipoU = tp;
                //console.log(this.tipoU);
            };

            this.getUser = function () { return this.user; };
            this.getTipo = function () { return this.tipoU; };
        }

       

        //function () {



        //}


    </script>

</body>
</html>